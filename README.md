üá¨üáß [English](./README.md) | üáπüáº [ÁπÅÈ´î‰∏≠Êñá](./README-zh-tw.md)

<img width="100%" src="./assets/images/project_graphics/banner.gif" alt="AI-Driven Construction Safety Banner">

<div align="center">
   <a href="examples/YOLO_server_api">Server-API</a> |
   <a href="examples/streaming_web">Streaming-Web</a> |
   <a href="examples/YOLO_data_augmentation">Data-Augmentation</a> |
   <a href="examples/YOLO_evaluation">Evaluation</a> |
   <a href="examples/YOLO_train">Train</a>
</div>

<br>

<div align="center">
   <!-- Row 1: Tools and Frameworks -->
   <a href="https://www.python.org/downloads/release/python-3127/">
      <img src="https://img.shields.io/badge/python-3.12.7-blue?logo=python" alt="Python 3.12.7">
   </a>
   <a href="https://github.com/ultralytics/ultralytics">
      <img src="https://img.shields.io/badge/YOLO11-ultralytics-blue?logo=yolo" alt="YOLO11">
   </a>
   <a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.HDBSCAN.html">
      <img src="https://img.shields.io/badge/HDBSCAN-sklearn-orange?logo=scikit-learn" alt="HDBSCAN sklearn">
   </a>
   <a href="https://fastapi.tiangolo.com/">
      <img src="https://img.shields.io/badge/fastapi-0.115.5-blue?logo=fastapi" alt="FastAPI 0.115.5">
   </a>
   <a href="https://redis.io/">
      <img src="https://img.shields.io/badge/Redis-7.0.15-red?logo=redis" alt="Redis 7.0.15">
   </a>
   <a href="https://www.docker.com/">
      <img src="https://img.shields.io/badge/Docker-Container-blue?logo=docker" alt="Docker">
   </a>

   <!-- Row 2: Testing, code quality and data -->
   <a href="https://github.com/pre-commit/pre-commit">
      <img src="https://img.shields.io/badge/pre--commit-4.0.1-blue?logo=pre-commit" alt="Pre-commit 4.0.1">
   </a>
   <a href="https://docs.pytest.org/en/latest/">
      <img src="https://img.shields.io/badge/pytest-8.3.4-blue?logo=pytest" alt="pytest 8.3.4">
   </a>
   <a href="https://codecov.io/github/yihong1120/Construction-Hazard-Detection" >
      <img src="https://codecov.io/github/yihong1120/Construction-Hazard-Detection/graph/badge.svg?token=E0M66BUS8D" alt="Codecov">
   </a>
   <a href="https://codebeat.co/projects/github-com-yihong1120-construction-hazard-detection-main">
      <img alt="codebeat badge" src="https://codebeat.co/badges/383396a9-e2cb-4604-8990-c1707e5870cf" />
   </a>
   <a href="https://universe.roboflow.com/object-detection-qn97p/construction-hazard-detection">
      <img src="https://app.roboflow.com/images/download-dataset-badge.svg" alt="Download Dataset from Roboflow">
   </a>
</div>

<br>

"Construction-Hazard-Detection" is an AI-powered tool designed to enhance safety on construction sites. By leveraging the YOLO model for object detection, it identifies potential hazards such as:

- Workers without helmets
- Workers without safety vests
- Workers near machinery or vehicles
- Workers in restricted areas, restricted areas will be automatically generated by computing and clustering the coordinates of safety cones.

Post-processing algorithms further improve detection accuracy. The system is built for real-time deployment, offering instant analysis and alerts for identified hazards.

Additionally, the system integrates AI recognition results in real-time via a web interface. It can send notifications and real-time on-site images through messaging apps like LINE, Messenger, WeChat, and Telegram for prompt alerts and reminders. The system also supports multiple languages, enabling users to receive notifications and interact with the interface in their preferred language. Supported languages include:

- üáπüáº Traditional Chinese (Taiwan)
- üá®üá≥ Simplified Chinese (Mainland China)
- üá´üá∑ French
- üá¨üáß English
- üáπüá≠ Thai
- üáªüá≥ Vietnamese
- üáÆüá© Indonesian

This multi-language support makes the system accessible to a global audience, improving usability across different regions.

<br>
<br>

<div align="center">
   <img src="./assets/images/hazard-detection.png" alt="Hazard Detection Diagram" style="width: 100%;">
</div>

<br>

## Contents

- [Hazard Detection Examples](#hazard-detection-examples)
- [Usage](#usage)
- [Additional Information](#additional-information)
- [Dataset Information](#dataset-information)
- [Contributing](#contributing)
- [Development Roadmap](#development-roadmap)
- [License](#license)

## Hazard Detection Examples

Below are examples of real-time hazard detection by the system:

<div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
  <!-- Example 1: Workers without Helmets or Safety Vests -->
  <div style="text-align: center; flex-basis: 33%;">
    <img src="./assets/images/demo/person_did_not_wear_safety_vest.png" alt="Workers without helmets or safety vests" style="width: 300px; height: 200px; object-fit: cover;">
    <p>Workers without Helmets or Safety Vests</p>
  </div>

  <!-- Example 2: Workers near Machinery or Vehicles -->
  <div style="text-align: center; flex-basis: 33%;">
    <img src="./assets/images/demo/person_near_machinery.jpg" alt="Workers near machinery or vehicles" style="width: 300px; height: 200px; object-fit: cover;">
    <p>Workers near Machinery or Vehicles</p>
  </div>

  <!-- Example 3: Workers in Restricted Areas -->
  <div style="text-align: center; flex-basis: 33%;">
    <img src="./assets/images/demo/persons_in_restricted_zones.jpg" alt="Workers in restricted areas" style="width: 300px; height: 200px; object-fit: cover;">
    <p>Workers in Restricted Areas</p>
  </div>
</div>

## Usage

Before running the application, you need to configure the system by specifying the details of the video streams and other parameters in a JSON configuration file. An example configuration file `config/configuration.json` should look like this:

```json
[
  {
    "video_url": "https://cctv1.kctmc.nat.gov.tw/6e559e58/",
    "site": "Kaohsiung",
    "stream_name": "Test",
    "model_key": "yolo11n",
    "notifications": {
      "line_token_1": "language_1",
      "line_token_2": "language_2"
    },
    "detect_with_server": true,
    "expire_date": "2024-12-31T23:59:59",
    "detection_items": {
      "detect_no_safety_vest_or_helmet": true,
      "detect_near_machinery_or_vehicle": true,
      "detect_in_restricted_area": true
    },
    "work_start_hour": 7,
    "work_end_hour": 18,
    "store_in_redis": true
  },
  {
    "video_url": "streaming URL",
    "site": "Factory_1",
    "stream_name": "camera_1",
    "model_key": "yolo11n",
    "notifications": {
      "line_token_3": "language_3",
      "line_token_4": "language_4"
    },
    "detect_with_server": false,
    "expire_date": "No Expire Date",
    "detection_items": {
      "detect_no_safety_vest_or_helmet": true,
      "detect_near_machinery_or_vehicle": false,
      "detect_in_restricted_area": true
    },
    "work_start_hour": 0,
    "work_end_hour": 24,
    "store_in_redis": true
  }
]
```

Each object in the array represents a video stream configuration with the following fields:

- `video_url`: The URL of the live video stream. This can include:
   - Surveillance streams
   - RTSP streams
   - Secondary streams
   - YouTube videos or live streams
   - Discord streams

- `site`: The location of the monitoring system (e.g., construction site, factory).

- `stream_name`: The name assigned to the camera or stream (e.g., "Front Gate", "Camera 1").

- `model_key`: The key identifier for the machine learning model to use (e.g., "yolo11n").

- `notifications`: A list of LINE messaging API tokens and corresponding languages for sending notifications.
   - `line_token_1`, `line_token_2`, etc.: These are the LINE API tokens.
   - `language_1`, `language_2`, etc.: The languages for the notifications (e.g., "en" for English, "zh-TW" for Traditional Chinese).

   Supported languages for notifications include:
   - `zh-TW`: Traditional Chinese
   - `zh-CN`: Simplified Chinese
   - `en`: English
   - `fr`: French
   - `vi`: Vietnamese
   - `id`: Indonesian
   - `th`: Thai

   For information on how to obtain a LINE token, please refer to [line_notify_guide_en](docs/en/line_notify_guide_en.md).

- `detect_with_server`: Boolean value indicating whether to run object detection using a server API. If `True`, the system will use the server for object detection. If `False`, object detection will run locally on the machine.

- `expire_date`: Expire date for the video stream configuration in ISO 8601 format (e.g., "2024-12-31T23:59:59"). If there is no expiration date, a string like "No Expire Date" can be used.

- `detection_items`: Specifies the safety detection items for monitoring specific scenarios. Each item can be set to `True` to enable or `False` to disable. The available detection items are:
   - `detect_no_safety_vest_or_helmet`: Detects if a person is not wearing a safety vest or helmet. This is essential for monitoring compliance with safety gear requirements on sites where such equipment is mandatory for personnel protection.
   - `detect_near_machinery_or_vehicle`: Detects if a person is dangerously close to machinery or vehicles. This helps prevent accidents caused by close proximity to heavy equipment or moving vehicles, often encountered in construction sites or industrial areas.
   - `detect_in_restricted_area`: Detects if a person has entered a restricted or controlled area. Restricted areas may be dangerous for untrained personnel or may contain sensitive equipment, so this setting aids in controlling access to such zones.

- `work_start_hour`: Specifies the hour (in 24-hour format) when the system should start monitoring the video stream. This allows monitoring to be restricted to active work hours, reducing unnecessary processing outside the defined timeframe (e.g., `7` for 7:00 AM).

- `work_end_hour`: Specifies the hour (in 24-hour format) when the system should stop monitoring the video stream. Monitoring will cease after this time to optimise resource usage (e.g., `18` for 6:00 PM).

   Together, `work_start_hour` and `work_end_hour` define the monitoring period during a day. For 24-hour monitoring, set `work_start_hour` to `0` and `work_end_hour` to `24`.

- `store_in_redis`: A boolean value that determines whether to store processed frames and associated detection data in Redis. If `True`, the system will save the data to a Redis database for further use, such as real-time monitoring or integration with other services. If `False`, no data will be saved in Redis.


<br>

Now, you could launch the hazard-detection system in Docker or Python env:

<details>
   <summary>Docker</summary>

   ### Usage for Docker

   To run the hazard detection system, you need to have Docker and Docker Compose installed on your machine. Follow these steps to get the system up and running:

   1. Clone the repository to your local machine.
      ```
      git clone https://github.com/yihong1120/Construction-Hazard-Detection.git
      ```

   2. Navigate to the cloned directory.
      ```
      cd Construction-Hazard-Detection
      ```

   3. Build and run the services using Docker Compose:
      ```bash
      docker-compose build
      ```

   4. To run the application, use the following command:
      ```bash
      docker-compose up
      ```
      You can view the detection results at http://localhost

   5. To stop the services, use the following command:
      ```bash
      docker-compose down
      ```

</details>

<details>
   <summary>Python</summary>

   ### Usage for Python

   To run the hazard detection system with Python, follow these steps:

   ### **1. Clone the Repository to Your Local Machine**

   Use the following command to clone the repository from GitHub:

   ```bash
   git clone https://github.com/yihong1120/Construction-Hazard-Detection.git
   ```

   ---

   ### **2. Navigate to the Cloned Directory**

   Change the directory to the newly cloned repository:

   ```bash
   cd Construction-Hazard-Detection
   ```

   ---

   ### **3. Install Required Packages**

   Run the following command to install the necessary Python packages:

   ```bash
   pip install -r requirements.txt
   ```

   ---

   ### **4. Install and Launch MySQL Service (if Required)**

   #### **For Ubuntu Users**

   1. Open the terminal and execute the following commands to install and start the MySQL server:

      ```bash
      sudo apt update
      sudo apt install mysql-server
      sudo systemctl start mysql.service
      ```

   #### **For Other Operating Systems**

   1. Download and install the appropriate version of MySQL for your operating system from the [MySQL Downloads](https://dev.mysql.com/downloads/) page.

   ---

   #### **Initialise the Database**

   After installing MySQL, use the following command to initialise the `construction_hazard_detection` database and create the `users` table:

   ```bash
   mysql -u root -p < scripts/init.sql
   ```

   You will be prompted to enter the MySQL root password. Ensure that the `scripts/init.sql` file contains the necessary SQL commands to set up the database and tables as described earlier.

   ---

   ### **5. Set Up Redis Server (Required Only for Streaming Web)**

   Redis is needed only when using the **Streaming Web** functionality. Follow the steps below to set up Redis.

   #### **For Ubuntu Users**

   1. **Install Redis**

      Open the terminal and run the following commands:

      ```bash
      sudo apt update
      sudo apt install redis-server
      ```

   2. **Configure Redis (Optional)**

      If you need custom settings, edit the Redis configuration file:

      ```bash
      sudo vim /etc/redis/redis.conf
      ```

      To enhance security, enable password protection by adding or modifying the following line:

      ```conf
      requirepass YourStrongPassword
      ```

      Replace `YourStrongPassword` with a secure password.

   3. **Start and Enable Redis Service**

      Start the Redis service:

      ```bash
      sudo systemctl start redis.service
      ```

      Enable Redis to start automatically on boot:

      ```bash
      sudo systemctl enable redis.service
      ```

   #### **For Other Operating Systems**

   Refer to the official [Redis installation guide](https://redis.io/docs/getting-started/installation/) for instructions specific to your operating system.

   ---

   ### **6. Run the Object Detection API**

   Start the object detection API with the following command:

   ```bash
   uvicorn examples.YOLO_server.backend.app:sio_app --host 0.0.0.0 --port 8001
   ```

   ---

   ### **7. Run the Main Application with a Specific Configuration File**

   Use the following command to run the main application and specify the configuration file:

   ```bash
   python3 main.py --config config/configuration.json
   ```

   Replace `config/configuration.json` with the actual path to your configuration file.

   ---

   ### **8. Start the Streaming Web Service**

   #### **Launching the Backend**

   ##### **For Linux Users**

   Run the following command to start the backend service on a Linux system:

   ```bash
   uvicorn examples.streaming_web.backend.app:sio_app --host 127.0.0.1 --port 8002
   ```

   ##### **For Windows Users**

   To start the backend service on a Windows system, use the following command:

   ```cmd
   waitress-serve --host=127.0.0.1 --port=8002 "examples.streaming_web.backend.app:streaming-web-app"
   ```

   ---

   #### **Setting Up the Frontend**

   Refer to the `examples/YOLO_server_api/frontend/nginx.conf` file for deployment instructions. Place the static web files in the following directory:

   ```plaintext
   examples/YOLO_server_api/frontend/dist
   ```

</details>

## Additional Information

- The system logs are available within the Docker container and can be accessed for debugging purposes.
- The output images with detections (if enabled) will be saved to the specified output path.
- Notifications will be sent through LINE messaging API during the specified hours if hazards are detected.

### Notes

- Ensure that the `Dockerfile` is present in the root directory of the project and is properly configured as per your application's requirements.

For more information on Docker usage and commands, refer to the [Docker documentation](https://docs.docker.com/).

## Dataset Information

The primary dataset for training this model is the [Construction Site Safety Image Dataset from Roboflow](https://www.kaggle.com/datasets/snehilsanyal/construction-site-safety-image-dataset-roboflow/data). We have enriched this dataset with additional annotations and made it openly accessible on Roboflow. The enhanced dataset can be found here: [Construction Hazard Detection on Roboflow](https://universe.roboflow.com/side-projects/construction-hazard-detection). This dataset includes the following labels:

- `0: 'Hardhat'`
- `1: 'Mask'`
- `2: 'NO-Hardhat'`
- `3: 'NO-Mask'`
- `4: 'NO-Safety Vest'`
- `5: 'Person'`
- `6: 'Safety Cone'`
- `7: 'Safety Vest'`
- `8: 'Machinery'`
- `9: 'Vehicle'`

### Models for detection

| Model   | size<br><sup>(pixels) | mAP<sup>val<br>50 | mAP<sup>val<br>50-95 | params<br><sup>(M) | FLOPs<br><sup>(B) |
| ------- | --------------------- | ------------------ | ------------------ | ----------------- | ----------------- |
| YOLO11n | 640                   | 58.0               | 34.2               | 2.6               | 6.5               |
| YOLO11s | 640                   | 70.1               | 44.8               | 9.4               | 21.6              |
| YOLO11m | 640                   | 73.3               | 42.6               | 20.1              | 68.0              |
| YOLO11l | 640                   | 77.3               | 54.6               | 25.3              | 86.9              |
| YOLO11x | 640                   | 82.0               | 61.7               | 56.9              | 194.9             |

<br>

Our comprehensive dataset ensures that the model is well-equipped to identify a wide range of potential hazards commonly found in construction environments.

## Contributing

We welcome contributions to this project. Please follow these steps:
1. Fork the repository.
2. Make your changes.
3. Submit a pull request with a clear description of your improvements.

## Development Roadmap

- [x] Data collection and preprocessing.
- [x] Training YOLO model with construction site data.
- [x] Developing post-processing techniques for enhanced accuracy.
- [x] Implementing real-time analysis and alert system.
- [x] Testing and validation in simulated environments.
- [x] Deployment in actual construction sites for field testing.
- [x] Ongoing maintenance and updates based on user feedback.

## TODO

- Add support for WhatsApp notifications.

## License

This project is licensed under the [AGPL-3.0 License](LICENSE.md).
